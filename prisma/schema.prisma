generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Product {
  id          Int         @id @default(autoincrement())
  slug        String      @unique
  name        String
  brand       String
  category    String      @default("tshirt") // "tshirt", "shorts", "pants", "beanie-hat"
  ageGroup    String      @default("adult")  // "adult", "kids"
  description String
  price       Int         // base price (fallback if no size-specific pricing)
  mrp         Int         // base MRP (fallback)
  tags        String      // comma-separated tags
  sizes       String      // comma-separated sizes
  sizePricing String?     // JSON: {"S": {"price": 499, "mrp": 599}, "M": {...}}
  image       String      // primary image path
  gallery     String?     // comma-separated extra image paths
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  orderItems  OrderItem[]
  reviews     Review[]    // Product reviews
}

model Brand {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model BrandPricing {
  id          Int      @id @default(autoincrement())
  brand       String
  category    String   // "tshirt", "pants", "hat" - category-specific pricing
  ageGroup    String   // "adult", "kids" - age-specific pricing
  sizePricing String   // JSON: {"S": {"price": 499, "mrp": 599}, "M": {...}}
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([brand, category, ageGroup]) // One pricing per brand+category+ageGroup combo
}

model Order {
  id                 Int         @id @default(autoincrement())
  orderNumber        String      @unique
  customerId         Int?        // Null for guest orders
  customer           Customer?   @relation(fields: [customerId], references: [id], onDelete: SetNull)
  customerName       String
  customerEmail      String
  customerPhone      String
  shippingAddress    String
  city               String
  state              String
  pincode            String
  subtotal           Int
  shipping           Int
  total              Int
  paymentMethod      String      // "razorpay", "cod"
  paymentStatus      String      @default("pending") // "pending", "paid", "failed"
  orderStatus        String      @default("pending") // "pending", "processing", "shipped", "delivered", "cancelled"
  notes              String?
  razorpayOrderId    String?
  razorpayPaymentId  String?
  createdAt          DateTime    @default(now())
  updatedAt          DateTime    @updatedAt
  items              OrderItem[]
  reviews            Review[]    // Reviews from this order
}

model OrderItem {
  id        Int      @id @default(autoincrement())
  orderId   Int
  productId Int
  name      String   // Store product name at time of order
  size      String
  quantity  Int
  price     Int      // Store price at time of order
  order     Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product   Product  @relation(fields: [productId], references: [id])
  createdAt DateTime @default(now())
}

model Admin {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String   // hashed password
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Customer {
  id              Int      @id @default(autoincrement())
  email           String   @unique
  password        String   // hashed password
  name            String
  phone           String?
  // Default shipping address (users can override at checkout)
  address         String?
  city            String?
  state           String?
  pincode         String?
  orders          Order[]  // All orders linked to this customer
  reviews         Review[] // Customer reviews
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Review {
  id          Int      @id @default(autoincrement())
  productId   Int
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  customerId  Int?     // Null for fake/seed reviews
  customer    Customer? @relation(fields: [customerId], references: [id], onDelete: SetNull)
  orderId     Int?     // Only set for verified purchases
  order       Order?   @relation(fields: [orderId], references: [id], onDelete: SetNull)
  rating      Int      // 1-5 stars
  title       String?  // Optional review title
  comment     String   // Review text
  isVerified  Boolean  @default(false) // True if from actual purchase
  isFake      Boolean  @default(false) // True for seed/fake reviews
  customerName String  // Display name (for fake reviews or override)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([productId])
  @@index([customerId])
}
